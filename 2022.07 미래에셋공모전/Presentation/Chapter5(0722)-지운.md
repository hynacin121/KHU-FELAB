# __Chapter 5 블랙-리터만모델__

### __평균-분산 모델의 한계__
+ 투자효율성에 대한 증명은 되었지만, 현실 시장에 적용하기 어려움
    1. 과거자료를 가지고 기대수익률과 변동성을 다룸 -> 투자대상의 미래가치 장담X
    2. 투자 비중이 배분되지 않고 일부 자산에 과도한 비중으로 투자(기대수익률, 위험측정 오차가 최적화 단계에서 증폭되기 때문)
+ 블랙-리터만 모델은 '베이즈 정리'를 바탕으로 투자자산군에 대한 투자자 기대를 반영해 이러한 문제들을 효과적으로 제거
+ 블랙-리터만 모델은 자산 배분은투자 가능한 모든 자산의 시장가치에 따라 비례적이어야 한다는 균형 가정에서 출발
+ M-V : 수익률과 변동성 토대로 계산, B-R : 변동성과 비중을 토대로 기대수익률 계산

## __5.1 블랙-리터만 모델__

### __모델 계산 방법__

1. 자산 각각의 시가총액 비중을 구함. 내재균형수익률 계산, 시가총액 = 발행주식수 X 주식가격
2. 기대수익률에 대한 분석 or 전망 설정. 이를 사전분포(prior distribution)으로 설정
3. 내재균형수익률과 사전분포를 이용해 사후분포(posterior distribution) 계싼

OR

1. 시장비중, 과거 종가 데이터, 무위험 이자율과 같은 데이터 수집
2. 위험회피계수($\lambda$)
3. 위험조정상수($\tau$)
4. 균형기대수익률($\pi$)
5. 시장 전망 반영과 결과
6. 결합전망 기대 수익률
7. 최적 투자 비중

## __5.2 베이지안 확률__

$$
P(H \vert E) = \frac{P(H)\  \cdot \ P(E \vert H) }{P(E)}
$$

+ $P(H \vert E)$ : 증거 E가 관찰된 상황에서 가설 H가 참일 확률
+ $P(H)$ :  가설 H가 참일 확률
+ $P(E \vert H)$ : 가설 H가 참일 때 증거 E가 관측될 확률
+ $P(E)$ : 증거 E가 관측될 확률

### __확률의 덧셈정리, 곱셈정리__

+ 확률의 덧셈 정리 $ P(A) \ + \ P(B) \ - P(A \cap B) = P(A \cup B) $
+ 확률의 곱셈 정리 $ P(B \vert A) P(A) = P(A \vert B)P(B) = P(A \cap B) $
+ $ P(B \vert A) P(A) = P(A \vert B)P(B) \rightarrow P(A \vert B) = \frac{P(B \vert A) P(A)}{P(B)} $

## __역최적화로 구하는 균형기대수익률__

+ 블랙-리터만 모델은 시가총액이 시장균형을 이룬 투자 비중이라고 가정.
+ 샤프의 내재수익률(CAPM으로 도출한 균형기대수익률)을 바탕으로 진행 
+ $E(r_i) = r_f + \beta(E(r_m) - r_F)$
+ $\beta = cov(r_I, r^Tw_m)/\sigma_m^2, \pi = E(r) - r_f, \delta = (E(r_m)-r_f)/\sigma^2_m$ 
+ 다음과 같은 균형기대수익률이 도출된다

$$
\pi = \lambda \Sigma w_m
$$ 
where $\lambda$ : 위험회피계수, $\Sigma$ : 자산의 공분산행렬, $w_m$ : 가중치
+  자산의 시가총액 비중을 균형 비중으로 가정하고 비중을 역으로 계산해 자산별 수익률을 계싼함

### __5.3.1 균형기대수익률($\Pi$)__
+ 블랙 리터만 모델은 시장 내 각자 자산의 시가총액이 균형 잡힌 결과로 봄. 현재 자본시장의 시가총액을 균형자산배분으로 봄
+ 위험회피계수와 투자자산들의 수익률 상관계수, 균형 배분된 시가총액 비중을 통해 균형 기대수익률을 구함

$$
\Pi = \lambda \Sigma w_{mkt}
$$ 

+ $\Pi$ : 균형기대수익률 ($N \times 1$ 벡터) 
+ $\lambda$ : 위험회피계수(스칼라 상수) 
+ $\Sigma$ : 자산의 공분산행렬($N \times N $ 벡터) 
+ $w_m$ : 가중치 ($N \times 1$ 벡터) 

$$
총내재 수익률 = \Pi + r_f
$$

### __5.3.2 위험회피계수($\lambda$)__
+ 투자자의 위험에 대한 태도
+ 위험회피계수가 클수록 무위험자산 투자 비중이 높아지고, 위험자산 투자비중은 낮아짐

$$
\lambda = \frac{r_{BM} -r_f}{\sigma^2_{BM}}
$$

+ $r_{BM}$ : 시장포트폴리오 기대수익률
+ $r_f$ : 무위험이자율
+ $\sigma^2_{BM}$ : 시장포트폴리오 수익률 분산. $\sigma^2 = W^T_{mkt}\Sigma \ W_{mkt}$

### __5.3.3 자산의 공분산 행렬($\Sigma$)__

+ 각 자산의 무위험수익률을 초과하는 수익률간의 공분산 계산

### __5.3.4 자산시가총액 비중($W_{mkt}$)__

$$
자산시가총액비중 = \frac {자산시가총액}{자산시가총액합계}
$$

+ 앞선 균형 기대수익률 수식에서, 균형기대수익률($\Pi$)을 초과수익률($\mu$)로 바꾸고 식을 정리하면 포트폴리오 최적 비중을 구하는 다음과 같은 식이 됌  
$$ 
w = (\lambda \Sigma)^{-1}\mu
$$

## __5.4 투자자 전망__

+ 절대적 전망 
    ex) 대형주가 절대적인 5%의 수익률을 낼 것이다
+ 상대적 전망
    ex) 일본국채 수익률이 미국국채 수익률 보다 25bp(0.25%) 앞설 것이다.
+ 자산수익률의 확률분포는 시간의 흐름에 따라 변하지 않는다고 가정하고 과거 자료를 이용함.
+ 과거 수익률의 빈도수 분포로부터 미래 수익률의 확률분포를 알 수 있음
+ 기대 수익률은 평균이 $\pi$ 고, 분산이 $\Sigma$ 인 정규분포를 따르는 것으로 알려져 있음
$$
\mu  \sim   N(\pi, \Sigma) 
$$

+ $\pi$ : 기대수익률 평균 ($N \times 1$ 벡터) 
+ $\Sigma$ : 수익률의 공분산  ($N \times N$ 벡터) 

+ 사전분포에 해당하는 투자자 전망은 다음과 같이 정의

$$
P \dot E(r) = Q + \epsilon, \epsilon \sim   N(Q, \Omega) 
$$

+ P : 투자자 전망 행렬 (n개의 자산에 대한 k개의 전망으로 구성된 $k \times N$ 벡터)
+ E(r) : 기대수익률 ($N \times 1$ 벡터)
+ Q : 투자자 전망에 대한 기대수익률 (전망 벡터 $k \times 1$ 벡터)
+ $\epsilon$ : 투자자 전망 오차항 $k \times 1$ 벡터
+ $\Omega$ : 오차항 공분산 행렬 $k \times k$ 벡터 

$$
Q \ + \ \epsilon = \begin{pmatrix}x_1\\ \vdots\\  x_n\end{pmatrix} + \begin{pmatrix}\epsilon_1\\ \vdots\\  \epsilon_n\end{pmatrix}
$$

+ 투자자산의 기대수익을 말할 때는 공분산 행렬을 사용해 불확실성의 수준을 표시
+ 투자자전망 행렬(P)와, 초과수익률 공분산($\Sigma$), 위험조정상수($\tau$)를 사용해 오차항 공분산 행렬 계산

$$
\Omega = P(\tau \Sigma)P^T \\ 

\Omega = \begin{pmatrix} P_1\Sigma P_1 \tau & \dots & 0 \\ \vdots & \cdots & \vdots \\  0 & \dots & P_k\Sigma P_k \tau\end{pmatrix}
$$

+ $\Omega$ 값은 전망치에 대한 불확실성의 정도를 수치화 한것이며 전망에 대한 분산으로 표현됌
+ 투자전망하에 기대수익률을 업데이트 하면 다음과 같다
$$
E(\mu \vert views) = [(\tau E)^{-1} + P^T\Omega^{-1}P]^{-1}[E^{-1}\Pi + P^T\Omega^{-1}Q]
$$

+ 투자자의 전망이 확실해 오차항이 없다면 다음과 같이 할 수 있다.

$$
E(\mu \vert views) = \Pi + \tau \Sigma P^T[\tau P \Sigma P^T]^{-1}
[Q - P\Pi]$$

#### __투자자 전망행렬 P__ 
+ 절대적 전망 : 행의 합은 1이됌 ex) 자산 1은 가장 좋은 성과를 낸다
+ 상대적 전망 : 행의 합은 0이됌 ex) 자산 3은 자산 2보다 좋은 성과를 낼 것이다.
$$
P = \begin{bmatrix}1&0&0\\ 0 & -1 & 1\\ \end{bmatrix}
$$

## __5.5 블랙-리터만 공식__

$$
E[R] = [(\tau \Sigma)^{-1} + P^T \Omega^{-1} P]^{-1}[(\tau \Sigma)^{-1}\Pi + P^T\Omega^{-1}Q]
$$

+ $\tau$ : 위험조정상수 (스칼라)
+ $\Sigma$ : 초과수익 공분산 행렬 ($N \times N$ 벡터) 
+ $P$ : 투자자산의 전망 행렬 ($k \times N$ 벡터) 
+ $\Omega$ : 각 전망의 불확실성에 대한 공분산 대각행렬 ($k \times k$ 벡터) 
+ $\Pi$ : 균형기대수익률벡터 ($n \times 1$ 벡터) 
+ $Q$ : 전망기대수익률벡터 ($k \times 1$ 벡터) 
+ $ [(\tau \Sigma)^{-1}\Pi + P^T\Omega^{-1}Q] $ 안에 $(\tau \Sigma)^{-1}$ 과 $P^T\Omega^{-1}$이 보이는데 각각은 균형기대수익률에 대한 신뢰가중치, 투자자의 전망에 대한 신뢰가중치를 의미한다.

+ 앞서 살펴본 블랙-리터만 식을 변형하면 아래와 같은 식이 나온다

$$
E(R) = \Pi + \tau \Sigma P^T[\Omega + \tau P \Sigma P^T]^{-1}[Q - P\Pi] = \Pi + V
$$

## __5.6 위험조정상수($\tau$)__

+ 표본조사로 인해서 나오는 표준편차는 표본 개수가 아무리 많아도 전체 데이터 개수보다 작기 때문에 표본 표준편차는 전체 표준편차보다 크다. 이러한 차이를 보정하는 장치가 위험조정상수다.
$$
위험조정상수(\tau) = \frac{1}{초과수익률 \ 공분산(\Sigma)에 \ 사용된 \ 표본개수(n)}
$$

## __5.7 균형기대수익률과 투자자 전망 결합__

$$
P(E \vert \Pi) = \frac{P(\Pi \vert E) P(E)}{P(\Pi)}
$$

+ 블랙 리터만 모델은 균형수익률($\Pi$)이라는 사건에 투자자의 전망이 반영돼 기대수익률(E)을 도출하는 것이다. 

$$
E \vert \Pi \sim N([(\tau \Sigma)^{-1} + P^T\Omega ^{-1}P]^{-1}[(\tau \Sigma)^{-1} + P^T\Omega ^{-1}Q], [(\tau \Sigma)^{-1} + P^T\Omega ^{-1}P]^{-1})
$$

+ 일반적으로 기대수익률($ \hat E(r) $) 추정은 최소자승법을 이용하며, 다음과 같이 정리 된다.

$$
 \hat E(r) = \Pi + [\Sigma P^T[P\Sigma P^T + \Omega^T]^{-1}](Q-P\Pi)
$$

+ $\tau$ : 위험조정상수, 역사적 변동성과 기대수익률 사이의 괴리 조정
+ $\Sigma$ : 자산의 공분산 행렬
+ $P$ : 투자자산의 전망 행렬 
+ $\Omega$ : 각 자산의 전망(기대)수익률 
+ $Q$ : 전망의 불확실성

## __5.9 블랙-리터만 모델 최적화__
$$
\max \sum_{i=1}^n \mu BL_i - \frac{\lambda}{2} \sum_{i=1}^n\sum_{j=1}^n \sigma_{ij}w_iw_j \\
s.t. \ \sum_{i=1}^nw_i = 1, w_i \geq 0, i = 1,2, \cdots , n
$$
